### 🔧 Role of **NVIC (Nested Vector Interrupt Controller)** in ARM Cortex-M:

The **NVIC** is a hardware block in ARM Cortex-M microcontrollers responsible for:

---

## 🧠 **Key Responsibilities of NVIC**:

| Function                     | Description                                                       |
| ---------------------------- | ----------------------------------------------------------------- |
| **Interrupt Prioritization** | Supports nested interrupts with programmable priority levels.     |
| **Interrupt Masking**        | Allows enabling/disabling individual interrupts.                  |
| **Efficient Vectoring**      | Directly jumps to the interrupt vector without software overhead. |
| **Tail-Chaining**            | Skips unnecessary stack pops/pushes when moving between ISRs.     |
| **Dynamic ISR Control**      | Set/clear pending interrupts, change priority during runtime.     |

---

## 🛠️ **Registers Used in NVIC**:

| Register     | Purpose                          |
| ------------ | -------------------------------- |
| `NVIC_ISERx` | Interrupt Set Enable Register    |
| `NVIC_ICERx` | Interrupt Clear Enable Register  |
| `NVIC_ISPRx` | Interrupt Set Pending Register   |
| `NVIC_ICPRx` | Interrupt Clear Pending Register |
| `NVIC_IPRx`  | Interrupt Priority Register      |

> These are memory-mapped registers (addresses starting from `0xE000E100`).

---

## 🧪 Example: Basic ISR for External Interrupt (EXTI Line 0)

Let’s simulate a GPIO interrupt using NVIC on STM32-like Cortex-M MCU:

### ✅ 1. **Enable NVIC for EXTI Line 0**

```c
#define NVIC_ISER0   (*((volatile uint32_t*)0xE000E100)) // Enable register
#define EXTI0_IRQ    6  // IRQ number for EXTI line 0 (depends on MCU)

void NVIC_EnableIRQ(uint8_t IRQn) {
    NVIC_ISER0 = (1 << IRQn);  // Enable IRQn
}
```

---

### ✅ 2. **ISR Handler (Interrupt Service Routine)**

In the vector table, your handler might look like:

```c
void EXTI0_IRQHandler(void) {
    // Clear pending interrupt (example for STM32 EXTI)
    if (EXTI->PR & (1 << 0)) {
        EXTI->PR |= (1 << 0); // Clear pending flag
    }

    // Custom logic
    toggle_LED(); // A function that toggles an LED
}
```

---

### ✅ 3. **Startup Vector Table Example**

Your startup file includes a vector table like:

```c
void (* const vector_table[])(void) __attribute__((section(".isr_vector"))) = {
    (void*) &_stack_top,       // Initial stack pointer
    Reset_Handler,             // Reset handler
    NMI_Handler,
    HardFault_Handler,
    ...
    EXTI0_IRQHandler,          // Position of IRQ6 = EXTI line 0
};
```

---

## 🔁 Summary

| Feature           | Purpose                                                         |
| ----------------- | --------------------------------------------------------------- |
| **NVIC**          | Handles external/internal interrupts with priority and nesting. |
| **ISR**           | The function that runs when an interrupt occurs.                |
| **Vector Table**  | Maps IRQ numbers to handler functions in memory.                |
| **Tail-Chaining** | Saves time when switching between multiple ISRs.                |

---
