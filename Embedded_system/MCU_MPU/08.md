Hereâ€™s a simple **C-based state machine** for a **temperature-controlled fan** using a microcontroller like STM32, AVR, or MSP430. The logic turns the fan **ON**, **OFF**, or sets it to **HIGH SPEED** depending on temperature thresholds.

---

## ðŸ§  **States**

* `FAN_OFF`: Temperature below threshold
* `FAN_ON`: Moderate temperature
* `FAN_HIGH`: High temperature

---

## ðŸ”§ **Assumptions**

* Temperature read via ADC or I2C sensor (`get_temperature()`).
* Fan controlled via `set_fan_speed(level)`:

  * `0`: OFF
  * `1`: ON (normal)
  * `2`: HIGH speed

---

## ðŸ§± **Code: State Machine for Fan Control**

```c
#include <stdio.h>

// Enum for fan states
typedef enum {
    FAN_OFF,
    FAN_ON,
    FAN_HIGH
} FanState;

// Temperature thresholds (in Â°C)
#define TEMP_LOW_THRESHOLD     30
#define TEMP_HIGH_THRESHOLD    40

// Function prototypes
int get_temperature();               // Read temperature from sensor
void set_fan_speed(int level);      // Control fan speed (0=OFF, 1=ON, 2=HIGH)

// State machine function
void fan_state_machine() {
    static FanState state = FAN_OFF;
    int temperature = get_temperature();

    switch (state) {
        case FAN_OFF:
            if (temperature >= TEMP_LOW_THRESHOLD) {
                state = FAN_ON;
                set_fan_speed(1);
                printf("Fan ON\n");
            }
            break;

        case FAN_ON:
            if (temperature >= TEMP_HIGH_THRESHOLD) {
                state = FAN_HIGH;
                set_fan_speed(2);
                printf("Fan HIGH\n");
            } else if (temperature < TEMP_LOW_THRESHOLD - 2) {
                state = FAN_OFF;
                set_fan_speed(0);
                printf("Fan OFF\n");
            }
            break;

        case FAN_HIGH:
            if (temperature < TEMP_HIGH_THRESHOLD - 3) {
                state = FAN_ON;
                set_fan_speed(1);
                printf("Fan back to ON\n");
            }
            break;

        default:
            state = FAN_OFF;
            set_fan_speed(0);
            break;
    }
}

// Dummy function implementations for simulation/testing
int get_temperature() {
    // Replace with actual ADC or sensor read
    static int temp = 25;
    temp += 1; // Simulate temperature rise
    return temp;
}

void set_fan_speed(int level) {
    // Replace with GPIO/PWM code to control fan
    // Example: digitalWrite(FAN_PIN, level);
}

int main() {
    // Simulate loop
    for (int i = 0; i < 20; ++i) {
        fan_state_machine();
    }
    return 0;
}
```

---

## âœ… **Key Points**

* **Hysteresis** is used (subtracting a few degrees before switching back) to avoid rapid toggling.
* `static` variable in the function preserves state across calls.
* Real implementation would call `fan_state_machine()` in the **main loop** or **timer interrupt**.

---

Let me know if you want:

* STM32 HAL/PWM version
* Integration with LM35 or DHT11
* FreeRTOS task + state machine combo
