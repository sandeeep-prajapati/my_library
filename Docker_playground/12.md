## ğŸ§± Architecture Flow (Understand This First)

```
Browser
  â†“
Nginx (port 80)
  â”œâ”€â”€ /api/*  â†’ backend:8000
  â””â”€â”€ /       â†’ nextjs:3000
```

* Browser talks only to **Nginx**
* Nginx routes internally using **container names**
* No backend exposed publicly ğŸ”

---

## ğŸ“ Project Structure

```
nextjs-gateway/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ pages/
â””â”€â”€ backend/
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ main.py / main.go / app.js
    â””â”€â”€ requirements.txt
```

---

## ğŸ“„ `docker-compose.yml`

version: "3.9"

services:
frontend:
build: ./frontend
container_name: nextjs_frontend
volumes:
- ./frontend:/app
- node_modules:/app/node_modules
expose:
- "3000"
environment:
- NODE_ENV=development
- CHOKIDAR_USEPOLLING=true
networks:
- app_net

backend:
build: ./backend
container_name: backend_api
expose:
- "8000"
networks:
- app_net

nginx:
image: nginx:alpine
container_name: nginx_gateway
ports:
- "80:80"
volumes:
- ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
depends_on:
- frontend
- backend
networks:
- app_net

networks:
app_net:
driver: bridge

volumes:
node_modules:

---

## ğŸ“„ `nginx/nginx.conf` (API Gateway Rules)

events {}

http {
upstream frontend {
server frontend:3000;
}

upstream backend {
server backend:8000;
}

server {
listen 80;

```
# Backend API
location /api/ {
  proxy_pass http://backend;
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}

# Next.js frontend
location / {
  proxy_pass http://frontend;
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
}
```

}
}

---

## ğŸ“„ `frontend/Dockerfile` (Next.js â€“ Dev)

FROM node:20-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .
EXPOSE 3000
CMD ["npm", "run", "dev"]

---

## ğŸ“„ `backend/Dockerfile` (Example: FastAPI-style)

FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .
EXPOSE 8000
CMD ["python", "main.py"]

(You can swap this with **Django, Go, Node, Laravel** â€” architecture stays the same.)

---

## ğŸ§  Key Concepts Youâ€™re Using (Important)

### âœ… Service Discovery via Container Names

```nginx
proxy_pass http://backend;
```

* `backend` = Docker service name
* Docker DNS resolves it automatically
* No IPs, no config rewrites

---

### âœ… `expose` vs `ports`

* `frontend` & `backend` â†’ **internal only**
* `nginx` â†’ **public entry point**

This is **zero-trust internal networking**.

---

### âœ… API Gateway Pattern

Nginx handles:

* Routing
* Security
* Headers
* (Later) Auth, rate limiting, HTTPS

Your apps stay simple.

---

### âœ… Next.js + API Same Origin

Frontend can call:

```js
fetch("/api/users")
```

No CORS.
No hardcoded URLs.
Works everywhere.

---

## â–¶ï¸ Run the Stack

```bash
docker compose up --build
```

Open:

```
http://localhost
```

* `/` â†’ Next.js
* `/api/*` â†’ Backend API
