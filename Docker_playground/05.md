## üìÑ Improved `docker-compose.yml`

version: "3.9"

services:
db:
image: mysql:8.0
container_name: mysql_db
restart: always
environment:
MYSQL_ROOT_PASSWORD: root_pass
MYSQL_DATABASE: app_db
MYSQL_USER: app_user
MYSQL_PASSWORD: app_pass
volumes:
- ./mysql/data:/var/lib/mysql
networks:
- app_net
healthcheck:
test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
interval: 10s
timeout: 5s
retries: 5

php:
image: php:8.2-apache
container_name: php_app
ports:
- "8080:80"
volumes:
- ./php:/var/www/html
environment:
MYSQL_HOST: db
MYSQL_DATABASE: app_db
MYSQL_USER: app_user
MYSQL_PASSWORD: app_pass
depends_on:
db:
condition: service_healthy
networks:
- app_net

networks:
app_net:
driver: bridge

---

## üîç What We Improved (Line by Line, No Hand-waving)

---

## 1Ô∏è‚É£ Custom Network (Clean Isolation)

```yaml
networks:
  app_net:
    driver: bridge
```

* Creates a **private LAN** for your app
* Only containers on `app_net` can talk to each other
* Used in:

  * Microservices
  * Backend + DB separation
  * Security boundaries

üëâ This is how **real production stacks** are isolated.

---

## 2Ô∏è‚É£ Health Check (Critical for Databases)

```yaml
healthcheck:
  test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
  interval: 10s
  timeout: 5s
  retries: 5
```

What this does:

* Docker **actively checks** if MySQL is ready
* Not just ‚Äúcontainer started‚Äù
* But ‚Äúdatabase is accepting connections‚Äù

Without this:

* PHP may start
* DB may still be booting
* App crashes ‚ùå

---

## 3Ô∏è‚É£ `depends_on` (Done the Right Way)

```yaml
depends_on:
  db:
    condition: service_healthy
```

Important distinction:

* ‚ùå `depends_on` alone = order only
* ‚úÖ `condition: service_healthy` = **wait until DB is ready**

This is **senior-level Docker knowledge**.

---

## 4Ô∏è‚É£ Service Name as Hostname

```yaml
MYSQL_HOST: db
```

* `db` = service name
* Docker DNS resolves it automatically
* No IPs
* No hardcoding
* Works across environments

This exact pattern is used in:

* Django (`DATABASE_HOST`)
* Laravel
* Node.js
* Golang

---

## 5Ô∏è‚É£ Restart Policy (Stability)

```yaml
restart: always
```

* If MySQL crashes ‚Üí Docker restarts it
* Essential for:

  * Databases
  * Queues
  * Background workers

---

## ‚ñ∂Ô∏è Run It

```bash
docker compose up
```

Then check:

```bash
docker ps
```

You‚Äôll see:

* MySQL ‚Üí `healthy`
* PHP ‚Üí running & stable

Open:

```
http://localhost:8080
```

---
