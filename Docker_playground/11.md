## ğŸ§± Architecture Overview

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Client  â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                     â”‚
                 â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
                 â”‚ Nginx â”‚  (API Gateway)
                 â””â”€â”€â”€â”¬â”€â”€â”€â”˜
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚               â”‚                â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ auth    â”‚     â”‚ users   â”‚      â”‚ orders  â”‚
â”‚ service â”‚     â”‚ service â”‚      â”‚ service â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚               â”‚                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 shared network
                     â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
              â”‚ Log Stack   â”‚
              â”‚ Fluentd     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Project Structure

```
microservices/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ users/
â”‚   â””â”€â”€ orders/
â”‚       â””â”€â”€ Dockerfile + app
â””â”€â”€ logging/
    â””â”€â”€ fluentd.conf
```

(Each service can be Django, FastAPI, Go, Node â€” doesnâ€™t matter)

---

## ğŸ“„ `docker-compose.yml`

version: "3.9"

services:
nginx:
image: nginx:alpine
container_name: api_gateway
ports:
- "80:80"
volumes:
- ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
depends_on:
- auth
- users
- orders
networks:
- frontend
- backend

auth:
build: ./services/auth
container_name: auth_service
expose:
- "8000"
networks:
- backend
logging:
driver: fluentd
options:
fluentd-address: localhost:24224
tag: auth.logs

users:
build: ./services/users
container_name: users_service
expose:
- "8000"
networks:
- backend
logging:
driver: fluentd
options:
fluentd-address: localhost:24224
tag: users.logs

orders:
build: ./services/orders
container_name: orders_service
expose:
- "8000"
networks:
- backend
logging:
driver: fluentd
options:
fluentd-address: localhost:24224
tag: orders.logs

fluentd:
image: fluent/fluentd:v1.16
container_name: fluentd
ports:
- "24224:24224"
volumes:
- ./logging/fluentd.conf:/fluentd/etc/fluentd.conf
networks:
- backend

networks:
frontend:
driver: bridge
backend:
driver: bridge

---

## ğŸ“„ `nginx/nginx.conf` (Service Discovery in Action)

events {}

http {
upstream auth {
server auth:8000;
}

upstream users {
server users:8000;
}

upstream orders {
server orders:8000;
}

server {
listen 80;

```
location /auth/ {
  proxy_pass http://auth;
}

location /users/ {
  proxy_pass http://users;
}

location /orders/ {
  proxy_pass http://orders;
}
```

}
}

ğŸ‘‰ `auth`, `users`, `orders` are **service names**
Docker DNS resolves them automatically.

---

## ğŸ“„ `logging/fluentd.conf` (Centralized Logs)

<source>
  @type forward
  port 24224
</source>

<match *.logs>
@type stdout </match>

This:

* Collects logs from all services
* Tags them (`auth.logs`, `users.logs`, etc.)
* Outputs to a single stream (can later go to ELK)

---

## ğŸ§  Key Concepts (This Is the Gold)

### 1ï¸âƒ£ Service Discovery (No IPs Ever)

```yaml
proxy_pass http://auth;
```

* `auth` = container hostname
* Docker handles DNS
* Works across machines & environments

---

### 2ï¸âƒ£ Network Segmentation (Security)

* `frontend` â†’ public-facing (Nginx)
* `backend` â†’ private service-to-service traffic

Only Nginx touches the outside world ğŸ”

---

### 3ï¸âƒ£ Centralized Logging

```yaml
logging:
  driver: fluentd
```

* Every service logs to **one place**
* Debug microservices without SSH-ing everywhere
* Required for observability

---

### 4ï¸âƒ£ Horizontal Scalability (Ready)

Later you can do:

```bash
docker compose up --scale users=3
```

Nginx will load-balance automatically.

---

## â–¶ï¸ Run the Architecture

```bash
docker compose up --build
```

Then hit:

```
http://localhost/users/
http://localhost/auth/
http://localhost/orders/
```

Logs appear **centrally via Fluentd**.
