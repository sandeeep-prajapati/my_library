## üìÅ Project Structure

```
django-postgres/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ manage.py
‚îÇ   ‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.py
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ postgres/
    ‚îî‚îÄ‚îÄ data/
```

---

## üìÑ `.env`

POSTGRES_DB=app_db
POSTGRES_USER=app_user
POSTGRES_PASSWORD=app_pass
POSTGRES_HOST=db
POSTGRES_PORT=5432

DJANGO_SECRET_KEY=super-secret-key
DJANGO_DEBUG=1

---

## üìÑ `backend/Dockerfile`

FROM python:3.11-slim

ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

---

## üìÑ `docker-compose.yml`

version: "3.9"

services:
db:
image: postgres:16
container_name: postgres_db
restart: always
env_file:
- .env
volumes:
- ./postgres/data:/var/lib/postgresql/data
healthcheck:
test: ["CMD-SHELL", "pg_isready -U $POSTGRES_USER"]
interval: 10s
timeout: 5s
retries: 5
networks:
- backend_net

web:
build: ./backend
container_name: django_app
command: >
sh -c "
python manage.py migrate &&
python manage.py runserver 0.0.0.0:8000
"
volumes:
- ./backend:/app
ports:
- "8000:8000"
env_file:
- .env
depends_on:
db:
condition: service_healthy
networks:
- backend_net

networks:
backend_net:
driver: bridge

---

## üîç Why This Setup Is **Correct**

---

## 1Ô∏è‚É£ Live Reload (Auto Refresh)

```yaml
volumes:
  - ./backend:/app
```

* Code changes locally
* Reflected instantly in container
* Django auto-reload handles restarts

No rebuilds needed üöÄ

---

## 2Ô∏è‚É£ Automatic Migrations (Pro Move)

```yaml
command: >
  sh -c "
  python manage.py migrate &&
  python manage.py runserver 0.0.0.0:8000
  "
```

* Runs migrations **every startup**
* Prevents:

  * Missing tables
  * ‚Äúrelation does not exist‚Äù errors

This is **industry practice** for dev environments.

---

## 3Ô∏è‚É£ Database Readiness (No Race Conditions)

```yaml
depends_on:
  db:
    condition: service_healthy
```

* Django starts **only when Postgres is ready**
* No connection failures on boot

---

## 4Ô∏è‚É£ Persistent Database

```yaml
./postgres/data:/var/lib/postgresql/data
```

* Container restart ‚â† data loss
* Essential for real development

---

## 5Ô∏è‚É£ Django Settings (Minimal Change)

In `settings.py`:

```python
import os

DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.postgresql",
        "NAME": os.getenv("POSTGRES_DB"),
        "USER": os.getenv("POSTGRES_USER"),
        "PASSWORD": os.getenv("POSTGRES_PASSWORD"),
        "HOST": os.getenv("POSTGRES_HOST"),
        "PORT": os.getenv("POSTGRES_PORT"),
    }
}
```

---

## ‚ñ∂Ô∏è Run the Stack

```bash
docker compose up --build
```

Open:

```
http://localhost:8000
```

You‚Äôre now running:

* Django
* PostgreSQL
* Live reload
* Auto migrations
* Docker-native dev env
