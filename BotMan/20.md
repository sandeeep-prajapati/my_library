To implement a chatbot rating system at the end of an order conversation using **Botman** in Laravel, follow these steps:

---

### ✅ Step 1: Update the Orders Table to Include Rating & Feedback

In your migration:

```php
Schema::table('orders', function (Blueprint $table) {
    $table->tinyInteger('rating')->nullable();
    $table->text('feedback')->nullable();
});
```

Run:

```bash
php artisan migrate
```

---

### ✅ Step 2: Modify the Conversation Class to Ask for Rating

In your Botman conversation (e.g., `OrderConversation.php`):

```php
use BotMan\BotMan\Messages\Outgoing\Question;
use BotMan\BotMan\Messages\Outgoing\Actions\Button;

public function askForRating()
{
    $question = Question::create("Thank you for your order! Please rate us from 1 to 5 stars.")
        ->addButtons([
            Button::create('⭐️')->value(1),
            Button::create('⭐️⭐️')->value(2),
            Button::create('⭐️⭐️⭐️')->value(3),
            Button::create('⭐️⭐️⭐️⭐️')->value(4),
            Button::create('⭐️⭐️⭐️⭐️⭐️')->value(5),
        ]);

    $this->ask($question, function($answer) {
        $rating = $answer->getValue();

        $this->say("Thanks for rating us {$rating} stars! Could you please leave a short feedback?");
        $this->askFeedback($rating);
    });
}

public function askFeedback($rating)
{
    $this->ask('Your feedback (optional):', function($answer) use ($rating) {
        $feedback = $answer->getText();

        // Save to database (assumes last order ID stored in session)
        $orderId = session('latest_order_id');
        \App\Models\Order::find($orderId)->update([
            'rating' => $rating,
            'feedback' => $feedback,
        ]);

        $this->say("Thank you for your feedback!");
    });
}
```

Call this at the end of the `run()` or after order confirmation.

---

### ✅ Step 3: Show Rating in Admin Panel

Add this to your admin order table view:

```blade
<td>{{ $order->rating ?? 'Not Rated' }}</td>
<td>{{ $order->feedback ?? '-' }}</td>
```

---

### ✅ Optional: Show Average Rating on Dashboard

Use Laravel Charts or simply:

```php
$average = \App\Models\Order::whereNotNull('rating')->avg('rating');
```

---

Let me know if you want a ready-made controller + view for managing reviews.
