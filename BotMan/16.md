To **design an admin feature that sends special offers or discount codes via Botman to users who interacted with the chatbot in the past week**, follow this step-by-step guide:

---

## âœ… 1. **Track Chatbot Interactions**

First, ensure you store each user's interaction timestamp:

### â¤ Create a `chat_interactions` table:

```bash
php artisan make:migration create_chat_interactions_table
```

**Migration Example:**

```php
Schema::create('chat_interactions', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->onDelete('cascade');
    $table->timestamp('last_interacted_at');
});
```

Update this timestamp every time a user interacts in your Botman middleware or controller.

---

## âœ… 2. **Create Admin Panel UI**

Create a form in your Laravel admin dashboard to:

* Enter a message or discount code
* Trigger the send action

**Example Form Fields:**

* Title: `Special Offer`
* Message: `Use code SAVE20 to get 20% off!`
* \[Send Button]

---

## âœ… 3. **Query Users from the Last Week**

In your controller method:

```php
use App\Models\User;
use Carbon\Carbon;
use BotMan\BotMan\BotManFactory;
use BotMan\BotMan\Drivers\DriverManager;

public function sendOfferToActiveUsers(Request $request)
{
    $message = $request->input('message');

    $users = User::whereHas('chatInteraction', function ($query) {
        $query->where('last_interacted_at', '>=', now()->subWeek());
    })->get();

    DriverManager::loadDriver(\BotMan\Drivers\Web\WebDriver::class);
    $botman = BotManFactory::create([]);

    foreach ($users as $user) {
        $botman->say($message, $user->chat_id, \BotMan\Drivers\Web\WebDriver::class);
    }

    return back()->with('success', 'Offer sent to active users!');
}
```

> ğŸ“ Make sure each user has a `chat_id` saved during initial interaction with the bot.

---

## âœ… 4. **Optional Enhancements**

* Add message templates (e.g., "Flat 30% off on all orders today!")
* Schedule future campaigns using `jobs` or `Laravel Scheduler`
* Track who received which offer (via `offer_logs` table)

---

## âœ… Example View (`admin/special_offer.blade.php`):

```blade
<form action="{{ route('admin.sendOffer') }}" method="POST">
    @csrf
    <label>Special Offer Message:</label>
    <textarea name="message" rows="4" required></textarea>
    <button type="submit" class="btn btn-primary mt-2">Send to Active Users</button>
</form>
```

---
