
---

## âœ… 1. Update Dish Model and Migration (already done)

Ensure your `dishes` table has a column:

```php
$table->boolean('available')->default(true);
```

And your `Dish.php` model has:

```php
protected $casts = [
    'available' => 'boolean',
];
```

---

## âœ… 2. Create Admin Panel Toggle (Real-time via AJAX)

In your Laravel Blade view for the admin panel (e.g., `resources/views/admin/dishes/index.blade.php`):

```blade
@foreach ($dishes as $dish)
<tr>
    <td>{{ $dish->name }}</td>
    <td>{{ $dish->price }}</td>
    <td>
        <input type="checkbox" class="availability-toggle" data-id="{{ $dish->id }}"
            {{ $dish->available ? 'checked' : '' }}>
    </td>
</tr>
@endforeach
```

Add AJAX (using jQuery or Fetch API):

```blade
<script>
document.querySelectorAll('.availability-toggle').forEach(toggle => {
    toggle.addEventListener('change', function () {
        const dishId = this.dataset.id;
        const available = this.checked;

        fetch(`/admin/dishes/${dishId}/toggle`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': '{{ csrf_token() }}'
            },
            body: JSON.stringify({ available })
        })
        .then(res => res.json())
        .then(data => {
            console.log(data.message);
        });
    });
});
</script>
```

---

## âœ… 3. Add Route and Controller Method

In `routes/web.php`:

```php
Route::post('/admin/dishes/{id}/toggle', [DishController::class, 'toggleAvailability']);
```

In `DishController.php`:

```php
public function toggleAvailability(Request $request, $id)
{
    $dish = Dish::findOrFail($id);
    $dish->available = $request->available;
    $dish->save();

    return response()->json(['message' => 'Availability updated']);
}
```

---

## âœ… 4. Update Botman Conversation to Filter by Availability

In your Botman `askMenu()` function:

```php
$menus = Menu::with(['dishes' => function ($query) {
    $query->where('available', true);
}])->get();

foreach ($menus as $menu) {
    $buttons = [];

    foreach ($menu->dishes as $dish) {
        $buttons[] = Button::create($dish->name . ' â‚¹' . $dish->price)->value($dish->id);
    }

    if (count($buttons)) {
        $question = Question::create("ðŸ“‹ *" . $menu->category_name . "* Menu:")
                    ->addButtons($buttons);

        $this->bot->reply($question);
    }
}
```

---

## âœ… Summary

* âœ… Dish availability can be toggled from the admin panel via checkbox (real-time AJAX).
* âœ… Dish data is automatically updated in the database.
* âœ… Botman pulls only dishes with `available = true`, so users only see what's currently available.
