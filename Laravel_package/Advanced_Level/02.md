
---

## 🎯 Goal:

* Listen to core Laravel events (e.g. `Illuminate\Auth\Events\Login`)
* Register listeners in your package
* Handle them with logic (e.g. logging, notifications, etc.)

---

## 🛠️ Step-by-Step Implementation

---

### 📁 1. Create Event Listener Class in Your Package

Create the directories:

```bash
mkdir -p packages/sandeep/mytools/src/Listeners
```

#### ✏️ `Listeners/UserLoginListener.php`

```php
<?php

namespace Sandeep\MyTools\Listeners;

use Illuminate\Auth\Events\Login;
use Illuminate\Support\Facades\Log;

class UserLoginListener
{
    public function handle(Login $event)
    {
        $user = $event->user;
        Log::info("[MyTools] User logged in: {$user->email}");
    }
}
```

> This listener reacts every time someone logs in and logs it using Laravel’s `Log`.

---

### 🧩 2. Create EventServiceProvider in Your Package

```bash
touch packages/sandeep/mytools/src/EventServiceProvider.php
```

#### ✏️ `EventServiceProvider.php`

```php
<?php

namespace Sandeep\MyTools;

use Illuminate\Auth\Events\Login;
use Illuminate\Foundation\Support\Providers\EventServiceProvider as ServiceProvider;
use Sandeep\MyTools\Listeners\UserLoginListener;

class EventServiceProvider extends ServiceProvider
{
    protected $listen = [
        Login::class => [
            UserLoginListener::class,
        ],
    ];
}
```

---

### ⚙️ 3. Register the EventServiceProvider in Main Service Provider

In `MyToolsServiceProvider.php`, register it like this inside `boot()` or `register()`:

```php
public function register()
{
    // Existing bindings...
    $this->app->register(EventServiceProvider::class);
}
```

---

### 🧪 4. Test the Event Listener

Start the Laravel app, then login with any user via your app’s login form or using `php artisan tinker`:

```bash
php artisan tinker

>>> auth()->loginUsingId(1);
```

Now check your `storage/logs/laravel.log`:

```
[2024-09-13 22:11:02] local.INFO: [MyTools] User logged in: sandeep@example.com
```

✅ It works!

---

## ✅ Summary

| ✅ Step                  | Description                                    |
| ----------------------- | ---------------------------------------------- |
| `UserLoginListener`     | Handles the `Login` event                      |
| `EventServiceProvider`  | Maps events to listeners                       |
| `register()` in package | Registers listener via custom service provider |
| `Log::info()`           | Verifies listener was triggered                |

---

### 🧠 Bonus: Listen to Model Events

For example, listen when a new `Tool` model is created:

```php
public static function booted()
{
    static::created(function ($tool) {
        \Log::info("Tool created: " . $tool->name);
    });
}
```

> Add this in your package model class (e.g., `Tool.php`).

---
