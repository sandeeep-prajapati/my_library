
---

## ✅ Prompt 16:

**Build a plugin architecture** using either:

* Laravel's modular approach (like `nWidart/laravel-modules`) **OR**
* A **custom plugin loader** in your package

We'll focus on a **custom plugin system** — lightweight, flexible, and perfect for packages.

---

## 🎯 Goal:

* Allow third-party or custom code (plugins) to hook into your package.
* Each plugin is a folder with a `PluginServiceProvider`, optional routes, migrations, views, etc.
* Auto-discover & load all plugins from a defined `plugins/` directory.

---

## 🛠️ Step-by-Step Implementation (Custom Plugin Loader)

---

### 📁 1. Define Plugin Folder Structure

Inside your package, create a `plugins/` directory:

```
packages/sandeep/mytools/
└── plugins/
    └── WelcomePlugin/
        ├── PluginServiceProvider.php
        ├── routes/
        │   └── web.php
        └── views/
            └── welcome.blade.php
```

---

### ✏️ 2. Create a Sample Plugin

#### `WelcomePlugin/PluginServiceProvider.php`

```php
<?php

namespace Sandeep\MyTools\Plugins\WelcomePlugin;

use Illuminate\Support\ServiceProvider;
use Illuminate\Support\Facades\Route;

class PluginServiceProvider extends ServiceProvider
{
    public function boot()
    {
        // Load plugin routes
        $this->loadRoutesFrom(__DIR__.'/routes/web.php');

        // Load plugin views
        $this->loadViewsFrom(__DIR__.'/views', 'welcomeplugin');
    }
}
```

---

#### `WelcomePlugin/routes/web.php`

```php
<?php

use Illuminate\Support\Facades\Route;

Route::get('/plugin/welcome', function () {
    return view('welcomeplugin::welcome');
});
```

---

#### `WelcomePlugin/views/welcome.blade.php`

```blade
<h1>Welcome from the Plugin!</h1>
```

---

### ⚙️ 3. Add a Plugin Loader in Your Main Service Provider

Update `MyToolsServiceProvider.php`:

```php
protected function loadPlugins()
{
    $pluginsPath = __DIR__ . '/../plugins';

    if (!is_dir($pluginsPath)) return;

    $directories = scandir($pluginsPath);

    foreach ($directories as $dir) {
        if ($dir === '.' || $dir === '..') continue;

        $providerClass = "Sandeep\\MyTools\\Plugins\\{$dir}\\PluginServiceProvider";

        if (class_exists($providerClass)) {
            $this->app->register($providerClass);
        }
    }
}
```

Call it from `boot()` or `register()`:

```php
public function boot()
{
    parent::boot();
    $this->loadPlugins();
}
```

---

### 📦 4. PSR-4 Autoload Setup

In `packages/sandeep/mytools/composer.json`:

```json
"autoload": {
    "psr-4": {
        "Sandeep\\MyTools\\": "src/",
        "Sandeep\\MyTools\\Plugins\\": "plugins/"
    }
}
```

Then run:

```bash
composer dump-autoload
```

---

### 🚀 5. Visit the Plugin Route

Start Laravel server:

```bash
php artisan serve
```

Visit:

```
http://localhost:8000/plugin/welcome
```

✅ Output:

> Welcome from the Plugin!

---

## ✅ Summary

| ✅ Component              | Purpose                          |
| ------------------------ | -------------------------------- |
| `plugins/` directory     | Stores plugin modules            |
| `PluginServiceProvider`  | Bootstraps plugin routes/views   |
| `loadPlugins()`          | Auto-registers plugin providers  |
| `composer.json autoload` | Ensures classes are discoverable |
| `view()`, `route()`      | Makes plugin components active   |

---

## 🧠 Advanced Tips

* Add plugin-specific config, migrations, or seeders.
* Support `enable/disable` for plugins via DB or config.
* Add CLI support like: `php artisan mytools:plugin install WelcomePlugin`

