
---

## ðŸŽ¯ Goal:

* Store plugin status (active/inactive) in the database
* Only register and boot active plugins
* (Optional) Create admin UI to toggle plugins

---

## ðŸ› ï¸ Step-by-Step Implementation

---

### âœ… 1. Create `plugins` Table in Migration

```bash
php artisan make:migration create_plugins_table
```

#### âœï¸ In the migration file:

```php
Schema::create('plugins', function (Blueprint $table) {
    $table->id();
    $table->string('name')->unique(); // Same as folder/plugin class name
    $table->boolean('is_active')->default(true);
    $table->timestamps();
});
```

Then:

```bash
php artisan migrate
```

---

### âœ… 2. Create `Plugin` Model (Optional)

```bash
php artisan make:model Plugin
```

#### âœï¸ `app/Models/Plugin.php`

```php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Plugin extends Model
{
    protected $fillable = ['name', 'is_active'];
}
```

---

### âœ… 3. Update Your Packageâ€™s `loadPlugins()` Method

In your `MyToolsServiceProvider` or PluginManager class:

```php
use App\Models\Plugin;

protected function loadPlugins()
{
    $pluginsPath = __DIR__ . '/../plugins';

    if (!is_dir($pluginsPath)) return;

    $pluginFolders = scandir($pluginsPath);

    // Load only active plugins from the DB
    $activePlugins = Plugin::where('is_active', true)->pluck('name')->toArray();

    foreach ($pluginFolders as $plugin) {
        if ($plugin === '.' || $plugin === '..') continue;

        if (!in_array($plugin, $activePlugins)) continue; // â›”ï¸ Skip inactive plugins

        $providerClass = "Sandeep\\MyTools\\Plugins\\{$plugin}\\PluginServiceProvider";

        if (class_exists($providerClass)) {
            $this->app->register($providerClass);
        }
    }
}
```

âœ… Now only **active** plugins are booted.

---

### âœ… 4. Add Plugins via Seeder (Optional)

Create a seeder:

```bash
php artisan make:seeder PluginSeeder
```

#### âœï¸ `PluginSeeder.php`

```php
use App\Models\Plugin;

public function run()
{
    Plugin::create(['name' => 'WelcomePlugin', 'is_active' => true]);
    Plugin::create(['name' => 'ChatBotPlugin', 'is_active' => false]);
}
```

Then run:

```bash
php artisan db:seed --class=PluginSeeder
```

---

### âœ… 5. Toggling Plugin State from Controller/UI

```php
use App\Models\Plugin;

public function togglePlugin($name)
{
    $plugin = Plugin::where('name', $name)->firstOrFail();
    $plugin->is_active = !$plugin->is_active;
    $plugin->save();

    return redirect()->back()->with('status', 'Plugin status updated!');
}
```

> You can call this via a button in your admin panel.

---

## âœ… Summary

| âœ… Feature           | Description                                |
| ------------------- | ------------------------------------------ |
| `plugins` DB table  | Stores activation state                    |
| `loadPlugins()`     | Loads only active plugins                  |
| `Plugin::is_active` | Toggle plugin status dynamically           |
| Admin toggle logic  | Allows UI for enabling/disabling plugins   |
| Future upgrade      | Add versioning, authors, description, etc. |

---

### ðŸ§  Bonus Tip: Use Artisan Command

Create a command like:

```bash
php artisan plugin:enable WelcomePlugin
php artisan plugin:disable ChatBotPlugin
```

Via `php artisan make:command PluginToggleCommand`

---
