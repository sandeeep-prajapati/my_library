
```bash
php artisan mytools:install
```

> This wizard helps the user set up config, run migrations, create admin, seed data, etc.

---

## ğŸ¯ Goal:

* Create an **Artisan command** like `mytools:install`
* Launch a **web-based setup wizard**
* Auto-publish configs/migrations
* Handle one-time install lock (to avoid re-install)

---

## ğŸ› ï¸ Step-by-Step Guide

---

### âœ… 1. Create the Artisan Command

```bash
php artisan make:command InstallMyToolsCommand --command=mytools:install
```

#### âœï¸ `InstallMyToolsCommand.php`

```php
<?php

namespace Sandeep\MyTools\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\Artisan;
use Illuminate\Support\Facades\File;

class InstallMyToolsCommand extends Command
{
    protected $signature = 'mytools:install';
    protected $description = 'Run the interactive installer for MyTools package';

    public function handle()
    {
        if (File::exists(storage_path('app/mytools_installed.lock'))) {
            $this->error('MyTools is already installed.');
            return Command::FAILURE;
        }

        $this->info('ğŸ“¦ Welcome to the MyTools Installer Wizard');
        $this->line('--------------------------------------------');

        // Step 1: Publish config and views
        $this->comment('ğŸ“¤ Publishing config, views, and migrations...');
        Artisan::call('vendor:publish', ['--tag' => 'mytools-config']);
        Artisan::call('vendor:publish', ['--tag' => 'mytools-views']);
        Artisan::call('vendor:publish', ['--tag' => 'mytools-migrations']);
        $this->info('âœ… Assets published.');

        // Step 2: Run migrations
        if ($this->confirm('Run database migrations now?')) {
            Artisan::call('migrate', ['--force' => true]);
            $this->info('âœ… Migrations run successfully.');
        }

        // Step 3: Create Admin User
        if ($this->confirm('Would you like to create an admin user?')) {
            $name = $this->ask('Enter admin name');
            $email = $this->ask('Enter admin email');
            $password = $this->secret('Enter admin password');

            \App\Models\User::create([
                'name' => $name,
                'email' => $email,
                'password' => bcrypt($password),
                'is_admin' => true,
            ]);

            $this->info("âœ… Admin user '$email' created.");
        }

        // Step 4: Create installation lock
        File::put(storage_path('app/mytools_installed.lock'), now());

        $this->info('ğŸ‰ Installation complete! You can now use MyTools.');
        return Command::SUCCESS;
    }
}
```

---

### âœ… 2. Register Command in `PackageServiceProvider`

```php
public function configurePackage(Package $package): void
{
    $package
        ->name('mytools')
        ->hasConfigFile()
        ->hasViews()
        ->hasRoute('web')
        ->hasMigration('create_tools_table')
        ->hasCommand(\Sandeep\MyTools\Console\Commands\InstallMyToolsCommand::class);
}
```

---

### âœ… 3. Optional: Create Wizard UI for Web Setup

Instead of CLI-only, letâ€™s give users an optional web interface:

#### Route: `routes/web.php`

```php
Route::get('/mytools/install', [\Sandeep\MyTools\Http\Controllers\InstallController::class, 'index']);
Route::post('/mytools/install', [\Sandeep\MyTools\Http\Controllers\InstallController::class, 'store']);
```

#### Controller: `InstallController.php`

```php
namespace Sandeep\MyTools\Http\Controllers;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\File;
use Illuminate\Support\Facades\Artisan;
use App\Models\User;

class InstallController extends Controller
{
    public function index()
    {
        if (File::exists(storage_path('app/mytools_installed.lock'))) {
            abort(403, 'Already installed.');
        }

        return view('mytools::install');
    }

    public function store(Request $request)
    {
        Artisan::call('vendor:publish', ['--tag' => 'mytools-config']);
        Artisan::call('vendor:publish', ['--tag' => 'mytools-migrations']);
        Artisan::call('migrate', ['--force' => true]);

        User::create([
            'name' => $request->admin_name,
            'email' => $request->admin_email,
            'password' => bcrypt($request->admin_password),
            'is_admin' => true,
        ]);

        File::put(storage_path('app/mytools_installed.lock'), now());

        return redirect('/')->with('status', 'MyTools Installed!');
    }
}
```

---

#### View: `resources/views/install.blade.php`

```blade
<form method="POST" action="/mytools/install">
    @csrf
    <label>Name: <input name="admin_name" required></label><br>
    <label>Email: <input type="email" name="admin_email" required></label><br>
    <label>Password: <input type="password" name="admin_password" required></label><br>
    <button type="submit">Install MyTools</button>
</form>
```

---

### âœ… 4. Lock File: Prevent Reinstallation

Both CLI and web-based installers check for:

```php
File::exists(storage_path('app/mytools_installed.lock'))
```

> Prevents accidental reinstallation.

---

## âœ… Summary

| âœ… Feature         | Implementation                |
| ----------------- | ----------------------------- |
| Artisan installer | `php artisan mytools:install` |
| Publish + migrate | Auto inside installer         |
| Admin setup       | CLI & Web                     |
| Lock file         | Prevents reinstall            |
| Optional web UI   | `/mytools/install` page       |

---

## ğŸ§  Bonus Tip

Want to auto-redirect users to the installer if not installed?

Add middleware like:

```php
if (!File::exists(storage_path('app/mytools_installed.lock'))) {
    return redirect('/mytools/install');
}
```

---

