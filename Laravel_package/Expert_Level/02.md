
---

## âœ… Prompt 17:

**Make your package SaaS-ready** by supporting:

* Tenant-aware logic (user, subdomain, database, etc.)
* Multi-tenant routing & model scopes
* SaaS feature restriction (e.g., by plan or tenant ID)

---

## ğŸ¯ Goal:

Build a **multi-tenant-ready architecture** inside your **custom Laravel package**, without forcing the host app to do heavy lifting.

---

## ğŸ› ï¸ Step-by-Step Guide

We'll go with a **basic SaaS tenancy by user/org ID**, and allow extension to **subdomain or DB-based** tenancy later.

---

### âœ… 1. Add `tenant_id` Support to Models (e.g., Tool)

In `Tool.php`:

```php
protected $fillable = ['name', 'tenant_id'];
```

---

### âœ… 2. Add a `BelongsToTenant` Trait

Create:

```bash
packages/sandeep/mytools/src/Traits/BelongsToTenant.php
```

#### âœï¸ `BelongsToTenant.php`

```php
<?php

namespace Sandeep\MyTools\Traits;

use Illuminate\Database\Eloquent\Builder;
use Illuminate\Support\Facades\Auth;

trait BelongsToTenant
{
    protected static function bootBelongsToTenant()
    {
        static::creating(function ($model) {
            if (Auth::check()) {
                $model->tenant_id = Auth::user()->id; // Or use organization_id
            }
        });

        static::addGlobalScope('tenant', function (Builder $builder) {
            if (Auth::check()) {
                $builder->where('tenant_id', Auth::user()->id);
            }
        });
    }
}
```

> Now all your models using this trait will **automatically filter by tenant**.

---

### âœ… 3. Apply the Trait to the Tool Model

```php
use Sandeep\MyTools\Traits\BelongsToTenant;

class Tool extends Model
{
    use HasFactory, BelongsToTenant;

    protected $fillable = ['name', 'tenant_id'];
}
```

---

### âœ… 4. Migration Update

Make sure your `tools` table has a `tenant_id`:

```php
$table->unsignedBigInteger('tenant_id');
```

---

### âœ… 5. Optional: Use Subdomain Routing for Tenants

In your `routes/web.php` inside the package:

```php
use Illuminate\Support\Facades\Route;

Route::domain('{tenant}.yourdomain.test')->group(function () {
    Route::get('/tools', function () {
        return \Sandeep\MyTools\Models\Tool::all();
    });
});
```

> Youâ€™ll need to define logic to resolve the `{tenant}` value into a real user/org.

---

### âœ… 6. Optional: Add Tenant Middleware

Create a `SetTenant` middleware that sets the current tenant ID from subdomain or session.

```php
// store tenant in session, database, or auth
session(['tenant_id' => $tenantId]);
```

Then resolve in global scope or trait.

---

### âœ… 7. Restrict Features by Plan

In `Tool.php` or controllers:

```php
if (auth()->user()->plan !== 'pro') {
    abort(403, 'Upgrade your plan to access this feature.');
}
```

You can even define a `canUse()` method or use Laravel Gates/Policies for feature checks.

---

## âœ… Summary

| âœ… Task                     | Description                    |
| -------------------------- | ------------------------------ |
| `tenant_id` column         | Stores the tenant/user/org ID  |
| `BelongsToTenant` trait    | Adds tenant-based global scope |
| Auth-aware queries         | Filter data by current tenant  |
| SaaS feature restrictions  | Prevent access based on plan   |
| Optional subdomain routing | Full multi-tenant architecture |

---

### ğŸ§  Bonus:

Want full-blown multitenancy with separate databases? Consider packages like:

* [`tenancy/tenancy`](https://github.com/tenancy/tenancy)
* [`spatie/multitenancy`](https://github.com/spatie/laravel-multitenancy)

â€¦but your current setup is **great for SaaS MVPs** and very **customizable**.

---
