Let's build a **Laravel controller** to handle a JSON POST request like:

```json
{ "packages": ["numpy", "scikit-learn"] }
```

It will:

* Read the JSON input
* Use the Python virtual environment (`.venv`)
* Run `pip install <packages>`
* Return success or error response

---

## âœ… Step-by-Step: Create `PythonPackageController`

### 1. ðŸ“¦ Create the Controller

```bash
php artisan make:controller PythonPackageController
```

---

### 2. ðŸ›  Modify the Controller

**File:** `app/Http/Controllers/PythonPackageController.php`

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Symfony\Component\Process\Process;

class PythonPackageController extends Controller
{
    public function installPackages(Request $request)
    {
        $request->validate([
            'packages' => 'required|array|min:1',
            'packages.*' => 'string',
        ]);

        $packages = $request->input('packages');
        $venvPath = base_path('.venv');

        // Determine pip path based on OS
        $pipPath = $venvPath . '/bin/pip';
        if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
            $pipPath = $venvPath . '\\Scripts\\pip.exe';
        }

        if (!file_exists($pipPath)) {
            return response()->json([
                'success' => false,
                'message' => 'Python virtual environment not found. Run `php artisan py:init` first.',
            ], 500);
        }

        // Run pip install
        $process = new Process(array_merge([$pipPath, 'install'], $packages));
        $process->run();

        if (!$process->isSuccessful()) {
            return response()->json([
                'success' => false,
                'message' => 'Installation failed.',
                'error' => $process->getErrorOutput(),
            ], 500);
        }

        // Optionally update requirements.txt
        $this->updateRequirementsTxt($packages);

        return response()->json([
            'success' => true,
            'message' => 'Packages installed successfully.',
            'output' => $process->getOutput(),
        ]);
    }

    private function updateRequirementsTxt(array $packages)
    {
        $reqPath = base_path('requirements.txt');
        $existing = file_exists($reqPath) ? file($reqPath, FILE_IGNORE_NEW_LINES) : [];

        foreach ($packages as $package) {
            $alreadyPresent = false;
            foreach ($existing as $line) {
                if (stripos($line, $package) === 0) {
                    $alreadyPresent = true;
                    break;
                }
            }
            if (!$alreadyPresent) {
                $existing[] = $package;
            }
        }

        file_put_contents($reqPath, implode(PHP_EOL, $existing) . PHP_EOL);
    }
}
```

---

### 3. ðŸ”— Add Route

Add this to `routes/api.php`:

```php
use App\Http\Controllers\PythonPackageController;

Route::post('/python/install', [PythonPackageController::class, 'installPackages']);
```

---

### 4. ðŸ§ª Test with CURL or Postman

**Request:**

```
POST /api/python/install
Content-Type: application/json

{
  "packages": ["numpy", "scikit-learn"]
}
```

**Expected JSON Response:**

```json
{
  "success": true,
  "message": "Packages installed successfully.",
  "output": "Collecting numpy...\nInstalling collected packages..."
}
```

---

### âœ… Bonus Features (Optional)

* Add a flag for `--upgrade`
* Return pip package versions after install
* Add middleware for API key if it's a public API
* Use job queue for long installs

---
