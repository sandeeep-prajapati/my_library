To allow **JSON communication** that **updates a specific version of a Python package**, weâ€™ll build a Laravel **API endpoint** that:

* Accepts this JSON:

  ```json
  {
    "package": "requests",
    "version": "2.31.0"
  }
  ```
* Runs:

  ```bash
  pip install requests==2.31.0
  ```
* Updates `requirements.txt` with:

  ```
  requests==2.31.0
  ```

---

## âœ… Step-by-Step: API Endpoint to Update a Specific Package Version

---

### 1. ðŸ›  Update the Controller (`PythonPackageController.php`)

Add a method named `updatePackageVersion`:

```php
use App\Services\PythonRequirementsService;
use Symfony\Component\Process\Process;
use Illuminate\Http\Request;

public function updatePackageVersion(Request $request)
{
    $validated = $request->validate([
        'package' => 'required|string',
        'version' => 'required|string',
    ]);

    $package = $validated['package'];
    $version = $validated['version'];
    $venvPath = base_path('.venv');

    // Determine pip path
    $pipPath = $venvPath . '/bin/pip';
    if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
        $pipPath = $venvPath . '\\Scripts\\pip.exe';
    }

    if (!file_exists($pipPath)) {
        return response()->json([
            'success' => false,
            'message' => 'Python virtual environment not found.',
        ], 500);
    }

    // Run pip install with version
    $this->info = "Installing {$package}=={$version}...";
    $process = new Process([$pipPath, 'install', "{$package}=={$version}"]);
    $process->run();

    if (!$process->isSuccessful()) {
        return response()->json([
            'success' => false,
            'message' => 'Installation failed.',
            'error' => $process->getErrorOutput(),
        ], 500);
    }

    // Update requirements.txt
    $reqService = new PythonRequirementsService();
    $reqService->addOrUpdatePackage($package, $version);

    return response()->json([
        'success' => true,
        'message' => "{$package} updated to version {$version}",
        'output' => $process->getOutput(),
    ]);
}
```

---

### 2. ðŸ“„ Add the Route in `routes/api.php`

```php
use App\Http\Controllers\PythonPackageController;

Route::post('/python/update', [PythonPackageController::class, 'updatePackageVersion']);
```

---

### 3. ðŸ“¤ Test with JSON

**POST `/api/python/update`**

```json
{
  "package": "requests",
  "version": "2.31.0"
}
```

**Expected Response:**

```json
{
  "success": true,
  "message": "requests updated to version 2.31.0",
  "output": "...pip install logs..."
}
```

---

## âœ… What Happens Behind the Scenes

* âœ” `pip install requests==2.31.0`
* âœ” Adds or updates line in `requirements.txt`

  ```
  requests==2.31.0
  ```

---

## ðŸ§  Bonus Ideas

* Accept multiple `{ package, version }` pairs
* Add rollback in case of failed install
* Return installed version for confirmation
* Add authentication (API key middleware)

---

