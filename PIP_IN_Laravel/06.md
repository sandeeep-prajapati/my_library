To **parse and update `requirements.txt` dynamically** in Laravel, you can create a **dedicated service class** that:

* Adds or updates a line like:

  ```txt
  package==version
  ```
* Ensures no duplicate entries
* Can be reused across controllers and commands

---

## ‚úÖ Step-by-Step: Laravel Service to Update `requirements.txt`

---

### 1. üõ† Create a Service Class

```bash
php artisan make:service PythonRequirementsService
```

> ‚ö†Ô∏è If `make:service` doesn't exist, just create manually:
> `app/Services/PythonRequirementsService.php`

---

### 2. ‚úèÔ∏è Implement the Service Logic

**File:** `app/Services/PythonRequirementsService.php`

```php
<?php

namespace App\Services;

class PythonRequirementsService
{
    protected string $filePath;

    public function __construct()
    {
        $this->filePath = base_path('requirements.txt');

        // Create file if it doesn't exist
        if (!file_exists($this->filePath)) {
            file_put_contents($this->filePath, '');
        }
    }

    /**
     * Add or update a package with a specific version in requirements.txt
     */
    public function addOrUpdatePackage(string $package, string $version): void
    {
        $lines = file($this->filePath, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
        $updated = [];
        $found = false;

        foreach ($lines as $line) {
            if (preg_match("/^" . preg_quote($package, '/') . "([=><!~].*)?$/i", $line)) {
                $updated[] = "{$package}=={$version}";
                $found = true;
            } else {
                $updated[] = $line;
            }
        }

        if (!$found) {
            $updated[] = "{$package}=={$version}";
        }

        file_put_contents($this->filePath, implode(PHP_EOL, $updated) . PHP_EOL);
    }

    /**
     * Remove a package entry from requirements.txt
     */
    public function removePackage(string $package): void
    {
        if (!file_exists($this->filePath)) return;

        $lines = file($this->filePath, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
        $updated = [];

        foreach ($lines as $line) {
            if (!preg_match("/^" . preg_quote($package, '/') . "([=><!~].*)?$/i", $line)) {
                $updated[] = $line;
            }
        }

        file_put_contents($this->filePath, implode(PHP_EOL, $updated) . PHP_EOL);
    }
}
```

---

### 3. üß™ Example Usage

You can now use this service from **any controller or command**:

```php
use App\Services\PythonRequirementsService;

public function someMethod()
{
    $service = new PythonRequirementsService();

    // Add or update numpy with version 1.26.0
    $service->addOrUpdatePackage('numpy', '1.26.0');

    // Remove a package if needed
    // $service->removePackage('flask');
}
```

---

### 4. ‚úÖ Integrate After Successful Install

You can fetch the installed version using:

```php
$process = new Process([$pipPath, 'show', 'numpy']);
$process->run();
preg_match('/^Version:\s+(.+)$/m', $process->getOutput(), $matches);
$version = $matches[1] ?? 'latest';
```

Then use:

```php
$reqService = new PythonRequirementsService();
$reqService->addOrUpdatePackage('numpy', $version);
```

---

## üîÑ Summary

| Feature      | Description                            |
| ------------ | -------------------------------------- |
| ‚úÖ Add/Update | `package==version` written or replaced |
| üßΩ Clean     | Avoids duplicates                      |
| ‚ôªÔ∏è Reusable  | Use in controllers, commands, APIs     |
| ‚ö° Fast       | Pure file operation, no DB             |

---

Let me know if you want:

* A Blade UI for managing requirements.txt
* A command like `php artisan py:update-req numpy` to manually trigger it
