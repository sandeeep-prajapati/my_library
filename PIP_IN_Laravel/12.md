Here’s how to create a **Laravel Artisan command** `py:update-all` to upgrade all Python packages inside your `.venv` environment:

It will:

* List all installed packages using `pip list --format=freeze`
* Upgrade each package to its latest version using `pip install --upgrade`

---

## ✅ Step-by-Step: `py:update-all` Command

---

### 1. 📦 Create the Command

```bash
php artisan make:command PyUpdateAllCommand
```

---

### 2. ✏️ Update Command File

**File:** `app/Console/Commands/PyUpdateAllCommand.php`

```php
<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use Symfony\Component\Process\Process;

class PyUpdateAllCommand extends Command
{
    protected $signature = 'py:update-all';
    protected $description = 'Upgrade all installed Python packages in the virtual environment to the latest versions';

    public function handle()
    {
        $venvPath = base_path('.venv');

        // Determine pip path
        $pipPath = $venvPath . '/bin/pip';
        if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
            $pipPath = $venvPath . '\\Scripts\\pip.exe';
        }

        if (!file_exists($pipPath)) {
            $this->error('.venv not found. Run `php artisan py:init` first.');
            return 1;
        }

        $this->info('Fetching list of installed packages...');

        // Get installed packages
        $listProcess = new Process([$pipPath, 'list', '--format=freeze']);
        $listProcess->run();

        if (!$listProcess->isSuccessful()) {
            $this->error('Failed to fetch installed packages.');
            $this->error($listProcess->getErrorOutput());
            return 1;
        }

        $packages = array_filter(explode(PHP_EOL, $listProcess->getOutput()));

        if (empty($packages)) {
            $this->info('No packages installed to upgrade.');
            return 0;
        }

        $this->info('Upgrading all packages...');

        foreach ($packages as $pkg) {
            $pkgName = explode('==', $pkg)[0] ?? null;
            if (!$pkgName) continue;

            $this->line("Upgrading {$pkgName}...");

            $upgradeProcess = new Process([$pipPath, 'install', '--upgrade', $pkgName]);
            $upgradeProcess->run();

            if (!$upgradeProcess->isSuccessful()) {
                $this->error("Failed to upgrade {$pkgName}:");
                $this->error($upgradeProcess->getErrorOutput());
            } else {
                $this->info("{$pkgName} upgraded successfully.");
            }
        }

        $this->info('All packages processed.');
        return 0;
    }
}
```

---

### 3. 🧪 Run the Command

```bash
php artisan py:update-all
```

**Expected Output:**

```
Fetching list of installed packages...
Upgrading numpy...
numpy upgraded successfully.
Upgrading pandas...
pandas upgraded successfully.
Upgrading requests...
requests upgraded successfully.
All packages processed.
```

---

### 4. ✅ Notes

* Works with `.venv` created by `py:init`
* Compatible with Linux/macOS and Windows
* Processes packages one by one to show progress
* Can be extended with a `--json` flag to output logs in JSON

---
