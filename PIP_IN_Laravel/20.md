Here’s a clean way to **expose Laravel wrapper functions** that run custom Python scripts via JSON input and return their output. This allows your Laravel backend to execute any Python script in the `.venv` environment safely.

---

## ✅ Step 1: Create a Controller for Python Scripts

```bash
php artisan make:controller PythonScriptController
```

---

### 2. Update Controller

**File:** `app/Http/Controllers/PythonScriptController.php`

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Symfony\Component\Process\Process;
use App\Services\PythonLoggerService;

class PythonScriptController extends Controller
{
    protected string $venvPath;

    public function __construct()
    {
        $this->venvPath = base_path('.venv');
    }

    protected function getPythonPath(): string
    {
        $python = $this->venvPath . '/bin/python';
        if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
            $python = $this->venvPath . '\\Scripts\\python.exe';
        }
        return $python;
    }

    public function run(Request $request)
    {
        $request->validate([
            'script' => 'required|string',
            'args'   => 'array',
        ]);

        $script = $request->input('script');
        $args = $request->input('args', []);

        $scriptPath = base_path("python_scripts/{$script}");
        if (!file_exists($scriptPath)) {
            return response()->json(['error' => 'Script not found'], 404);
        }

        $python = $this->getPythonPath();
        $process = new Process(array_merge([$python, $scriptPath], $args));
        $process->setTimeout(60); // adjust if needed
        $process->run();

        if (!$process->isSuccessful()) {
            PythonLoggerService::log(
                'run-script', 
                $script, 
                null, 
                'failure', 
                $process->getErrorOutput()
            );
            return response()->json([
                'error' => 'Script execution failed',
                'details' => $process->getErrorOutput()
            ], 500);
        }

        PythonLoggerService::log(
            'run-script', 
            $script, 
            null, 
            'success', 
            'Executed successfully'
        );

        return response()->json([
            'output' => $process->getOutput()
        ]);
    }
}
```

---

## ✅ Step 2: Create API Route

**File:** `routes/api.php`

```php
use App\Http\Controllers\PythonScriptController;

Route::post('/python/run', [PythonScriptController::class, 'run']);
```

---

## ✅ Step 3: Example JSON Request

```json
POST /api/python/run
Content-Type: application/json

{
    "script": "hello.py",
    "args": ["John", "Doe"]
}
```

---

### Example Python Script (`python_scripts/hello.py`)

```python
import sys
name1 = sys.argv[1] if len(sys.argv) > 1 else "World"
name2 = sys.argv[2] if len(sys.argv) > 2 else ""
print(f"Hello {name1} {name2}!")
```

**Response:**

```json
{
  "output": "Hello John Doe!\n"
}
```

---

## ✅ Step 4: Safety & Enhancements

1. **Whitelist scripts** – avoid executing arbitrary files.
2. **Timeouts** – prevent long-running or stuck scripts.
3. **Logging** – log execution and errors in `py-package.log`.
4. **Arguments sanitization** – escape special characters if passing user input.
5. **JSON output from Python** – you can enforce Python scripts to return JSON for easier parsing in Laravel.

---

If you want, I can **extend this system** to:

* Run scripts asynchronously in background
* Support hot-reloading for scripts
* Integrate with your Flask server or Artisan commands

…so Laravel becomes a full **Python script execution manager**, like a mini Vite for Python.

Do you want me to do that next?
