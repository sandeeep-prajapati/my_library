To create a `php artisan py:list` command that lists all installed Python packages from the `.venv`, we'll:

* Use `pip list --format=json`
* Display output in:

  * ✅ Tabular format in CLI
  * 🧾 Optional `--json` flag to show JSON output

---

## ✅ Step-by-Step: `py:list` Laravel Command

---

### 1. 📦 Create the Command

```bash
php artisan make:command PyListCommand
```

---

### 2. ✏️ Update the Command File

**File:** `app/Console/Commands/PyListCommand.php`

```php
<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use Symfony\Component\Process\Process;

class PyListCommand extends Command
{
    protected $signature = 'py:list {--json : Output in JSON format}';
    protected $description = 'List installed Python packages and their versions from the virtual environment';

    public function handle()
    {
        $venvPath = base_path('.venv');

        // Determine pip path
        $pipPath = $venvPath . '/bin/pip';
        if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
            $pipPath = $venvPath . '\\Scripts\\pip.exe';
        }

        if (!file_exists($pipPath)) {
            $this->error('Python virtual environment not found. Run `php artisan py:init` first.');
            return 1;
        }

        // Run pip list
        $process = new Process([$pipPath, 'list', '--format=json']);
        $process->run();

        if (!$process->isSuccessful()) {
            $this->error('Failed to retrieve package list.');
            $this->error($process->getErrorOutput());
            return 1;
        }

        $packages = json_decode($process->getOutput(), true);

        if ($this->option('json')) {
            $this->line(json_encode($packages, JSON_PRETTY_PRINT));
        } else {
            $this->table(['Package', 'Version'], array_map(function ($pkg) {
                return [$pkg['name'], $pkg['version']];
            }, $packages));
        }

        return 0;
    }
}
```

---

### 3. 🧪 Run the Command

#### ✅ CLI Output

```bash
php artisan py:list
```

**Output:**

```
+------------------+-----------+
| Package          | Version   |
+------------------+-----------+
| flask            | 2.2.2     |
| requests         | 2.31.0    |
| numpy            | 1.26.4    |
+------------------+-----------+
```

---

#### 🧾 JSON Output

```bash
php artisan py:list --json
```

**Output:**

```json
[
    {
        "name": "flask",
        "version": "2.2.2"
    },
    {
        "name": "requests",
        "version": "2.31.0"
    }
]
```

---

## 🧠 Bonus Suggestions

* Add `--search=term` to filter packages by name
* Add `--sort=asc|desc` for sorting by name/version
* Add `--export=filename.txt` to export list to a file

---
