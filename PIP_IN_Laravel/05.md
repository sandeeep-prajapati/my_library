Here's how to create a **Laravel Artisan command** called `py:remove` that uninstalls a specified Python package from your `.venv` and also removes it from `requirements.txt`.

---

## ✅ Step-by-Step: `php artisan py:remove flask`

---

### 1. 📦 Create the Command

```bash
php artisan make:command PyRemoveCommand
```

---

### 2. 🛠 Update the Generated File

Open `app/Console/Commands/PyRemoveCommand.php` and replace the contents with:

```php
<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use Symfony\Component\Process\Process;

class PyRemoveCommand extends Command
{
    protected $signature = 'py:remove {package}';
    protected $description = 'Uninstall a Python package from the virtual environment and update requirements.txt';

    public function handle()
    {
        $package = $this->argument('package');
        $venvPath = base_path('.venv');

        // Check for venv
        if (!is_dir($venvPath)) {
            $this->error('.venv not found. Run `php artisan py:init` first.');
            return 1;
        }

        // Determine pip path
        $pipPath = $venvPath . '/bin/pip';
        if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {
            $pipPath = $venvPath . '\\Scripts\\pip.exe';
        }

        if (!file_exists($pipPath)) {
            $this->error("pip not found in .venv.");
            return 1;
        }

        // Run uninstall command
        $this->info("Uninstalling Python package: {$package}");
        $process = new Process([$pipPath, 'uninstall', '-y', $package]);
        $process->run();

        if (!$process->isSuccessful()) {
            $this->error("Failed to uninstall package.");
            $this->error($process->getErrorOutput());
            return 1;
        }

        $this->info("Package {$package} uninstalled successfully.");
        $this->line($process->getOutput());

        // Remove from requirements.txt
        $this->removeFromRequirements($package);

        return 0;
    }

    private function removeFromRequirements($package)
    {
        $requirementsPath = base_path('requirements.txt');

        if (!file_exists($requirementsPath)) {
            return;
        }

        $lines = file($requirementsPath, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
        $updated = [];

        foreach ($lines as $line) {
            // Match lines like: flask==2.2.0 or flask
            if (!preg_match("/^" . preg_quote($package, '/') . "([=><!~].*)?$/i", trim($line))) {
                $updated[] = $line;
            }
        }

        file_put_contents($requirementsPath, implode(PHP_EOL, $updated) . PHP_EOL);
        $this->info("Removed {$package} from requirements.txt.");
    }
}
```

---

### 3. 🧪 Run the Command

```bash
php artisan py:remove flask
```

**Expected Output:**

```
Uninstalling Python package: flask
Package flask uninstalled successfully.
Removed flask from requirements.txt.
```

---

## ✅ What This Command Does

* Finds your `.venv`
* Runs `pip uninstall -y flask`
* Removes any matching line from `requirements.txt`:

  * `flask`
  * `flask==2.0.0`
  * `flask>=1.0`

---

## 🧠 Bonus Ideas

* Add support for multiple packages at once
* Add confirmation prompt unless `--force` is given
* Log uninstalls to `storage/logs/python.log`

---

Let me know if you'd like a companion command:

> 🔁 `php artisan py:update flask` → Update a specific package.
