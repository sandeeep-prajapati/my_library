### **Testing Vue Components in Laravel with Jest/Vitest**

Here's a comprehensive guide to setting up component tests in a Laravel+Vue project with modern tooling:

---

## **Option 1: Vitest (Recommended for Vite Projects)**
### **1. Install Dependencies**
```bash
npm install -D vitest @vue/test-utils jsdom @vitest/coverage-v8 happy-dom
```

### **2. Configure `vite.config.js`**
```javascript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';

export default defineConfig({
  plugins: [vue()],
  test: {
    globals: true,
    environment: 'happy-dom', // or 'jsdom'
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
    },
  },
});
```

### **3. Create Test Files**
Example for `resources/js/components/Button.vue`:
```javascript
// resources/js/components/__tests__/Button.spec.js
import { mount } from '@vue/test-utils';
import Button from '../Button.vue';

describe('Button Component', () => {
  it('renders with default slot', () => {
    const wrapper = mount(Button, {
      slots: {
        default: 'Click me',
      },
    });
    expect(wrapper.text()).toContain('Click me');
  });

  it('emits click event', async () => {
    const wrapper = mount(Button);
    await wrapper.trigger('click');
    expect(wrapper.emitted()).toHaveProperty('click');
  });
});
```

### **4. Add Test Scripts**
```json
"scripts": {
  "test": "vitest",
  "test:watch": "vitest watch",
  "test:coverage": "vitest run --coverage"
}
```

---

## **Option 2: Jest (Traditional Setup)**
### **1. Install Dependencies**
```bash
npm install -D jest @vue/test-utils @vue/vue3-jest babel-jest
```

### **2. Create `jest.config.js`**
```javascript
module.exports = {
  moduleFileExtensions: ['js', 'json', 'vue'],
  transform: {
    '^.+\\.js$': 'babel-jest',
    '^.+\\.vue$': '@vue/vue3-jest',
  },
  moduleNameMapper: {
    '^@/(.*)$': '<rootDir>/resources/js/$1',
  },
  testEnvironment: 'jsdom',
};
```

### **3. Add Babel Config (`babel.config.js`)**
```javascript
module.exports = {
  presets: [
    ['@babel/preset-env', { targets: { node: 'current' } }],
  ],
};
```

### **4. Example Test (Same syntax as Vitest)**
```javascript
import { mount } from '@vue/test-utils';
import Button from '@/components/Button.vue';
```

---

## **Testing Strategies for Laravel+Vue**

### **1. Testing Component Basics**
```javascript
// Component props
it('accepts color prop', () => {
  const wrapper = mount(Button, {
    props: { color: 'blue' },
  });
  expect(wrapper.classes()).toContain('bg-blue-500');
});
```

### **2. Testing Pinia Stores**
```javascript
// resources/js/stores/__tests__/auth.spec.js
import { setActivePinia, createPinia } from 'pinia';
import { useAuthStore } from '../auth';

beforeEach(() => {
  setActivePinia(createPinia());
});

it('logs in user', async () => {
  const store = useAuthStore();
  await store.login({ email: 'test@example.com', password: 'secret' });
  expect(store.user.email).toBe('test@example.com');
});
```

### **3. Testing API Calls (Mocking Axios)**
```javascript
import axios from 'axios';
jest.mock('axios');

it('fetches posts', async () => {
  axios.get.mockResolvedValue({ data: [{ id: 1, title: 'Test' }] });
  const wrapper = mount(PostsList);
  await flushPromises();
  expect(wrapper.findAll('li')).toHaveLength(1);
});
```

### **4. Testing Laravel Permissions**
```javascript
// Mock global $page props
const $page = {
  props: {
    auth: {
      user: {
        permissions: ['edit-posts'],
      },
    },
  },
};

it('hides button without permission', () => {
  const wrapper = mount(EditButton, {
    global: {
      mocks: { $page },
    },
    props: {
      requiredPermission: 'delete-posts',
    },
  });
  expect(wrapper.isVisible()).toBe(false);
});
```

---

## **CI/CD Integration**
### **GitHub Actions Example (`.github/workflows/tests.yml`)**
```yaml
name: Tests
on: [push]
jobs:
  vue-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npm run test:ci
      - uses: actions/upload-artifact@v3
        if: always()
        with:
          name: coverage
          path: coverage/
```

---

## **Key Recommendations**
| Tool | Best For |
|------|----------|
| **Vitest** | Vite projects, faster execution | 
| **Jest** | Legacy projects, more resources |
| **Testing Library** | Accessibility-focused tests |
| **Laravel Dusk** | Full browser tests |

**Coverage Thresholds:**
```javascript
// vitest.config.js
coverage: {
  thresholds: {
    lines: 80,
    functions: 80,
    branches: 60,
    statements: 80,
  },
},
```

---

## **Debugging Tips**
1. **Visual Debugging**:
   ```javascript
   console.log(wrapper.html());
   wrapper.find('button').trigger('click');
   ```
   
2. **Test Specific Files**:
   ```bash
   npx vitest run Button.spec.js
   ```

3. **Update Snapshots**:
   ```bash
   npm test -- -u
   ```

For complex components, combine **unit tests** with **Laravel Dusk** for full-stack testing. Start with critical path coverage (auth flows, payment components) before expanding.