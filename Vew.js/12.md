### **Vue Directives in Laravel: Extending Template Functionality**

Vue directives are special template attributes (prefixed with `v-`) that add reactive behavior to DOM elements. Laravel+Vue apps can leverage both built-in and custom directives for cleaner template logic.

---

## **1. Built-in Directives Cheat Sheet**
| Directive | Example | Purpose |
|-----------|---------|---------|
| `v-model` | `<input v-model="search">` | Two-way binding |
| `v-if/v-show` | `<div v-if="isVisible">` | Conditional rendering |
| `v-for` | `<li v-for="item in items">` | List rendering |
| `v-bind` | `<a :href="url">` | Dynamic attributes |
| `v-on` | `<button @click="submit">` | Event handling |
| `v-text` | `<span v-text="message">` | Text interpolation |

---

## **2. Creating Custom Directives**
### **2.1. Global Directive (Recommended for Reusability)**
Register in `resources/js/app.js`:
```javascript
const app = createApp({});

// Focus directive (auto-focuses input)
app.directive('focus', {
  mounted(el) {
    el.focus();
  }
});

// Usage in Blade/Vue:
// <input v-focus type="text">
```

### **2.2. Local Directive (Component-Scoped)**
```vue
<script setup>
const vHighlight = {
  mounted(el, binding) {
    el.style.backgroundColor = binding.value || 'yellow';
  }
};
</script>

<template>
  <p v-highlight="'#ff0'">This will be highlighted</p>
</template>
```

---

## **3. Laravel-Specific Directive Examples**
### **3.1. Permission Directive (Gate/Policies Integration)**
```javascript
// resources/js/directives/hasPermission.js
export default {
  mounted(el, binding, vnode) {
    const { value } = binding;
    const permissions = vnode.context.$page.props.auth.permissions;

    if (!permissions.includes(value)) {
      el.style.display = 'none';
      // OR: el.parentNode.removeChild(el);
    }
  }
};

// Register in app.js
import HasPermission from '@/directives/hasPermission';
app.directive('permission', HasPermission);

// Blade usage:
// <button v-permission="'edit-posts'">Edit</button>
```

### **3.2. Laravel Route Directive**
```javascript
// resources/js/directives/route.js
export default {
  beforeMount(el, binding) {
    el.href = route(binding.value, binding.arg);
  }
};

// Usage:
// <a v-route:href="'posts.show'" :arg="post.id">View</a>
```

---

## **4. Advanced Directive Patterns**
### **4.1. Debounced Click (Prevent Spam)**
```javascript
app.directive('debounce-click', {
  mounted(el, binding) {
    const delay = binding.value || 500;
    let timeout;
    
    el.addEventListener('click', () => {
      clearTimeout(timeout);
      timeout = setTimeout(() => {
        binding.arg(); // Call passed method
      }, delay);
    });
  }
});

// Usage:
// <button v-debounce-click:submitForm="300">Save</button>
```

### **4.2. Tooltip Directive (With Tippy.js)**
```javascript
import tippy from 'tippy.js';

app.directive('tooltip', {
  mounted(el, binding) {
    tippy(el, {
      content: binding.value,
      placement: binding.arg || 'top'
    });
  }
});

// Usage:
// <button v-tooltip:bottom="'Delete item'">X</button>
```

---

## **5. Directive Lifecycle Hooks**
| Hook | Timing | Common Uses |
|------|--------|-------------|
| `beforeMount` | Before element is inserted | Prepare data |
| `mounted` | After DOM insertion | DOM manipulations |
| `beforeUpdate` | Before component update | Cleanup |
| `updated` | After re-render | Post-update DOM work |
| `beforeUnmount` | Before removal | Event cleanup |

Example with cleanup:
```javascript
app.directive('scroll-spy', {
  mounted(el, binding) {
    const callback = binding.value;
    const observer = new IntersectionObserver((entries) => {
      callback(entries);
    });
    observer.observe(el);
    
    // Store observer for cleanup
    el._scrollSpyObserver = observer;
  },
  beforeUnmount(el) {
    el._scrollSpyObserver?.disconnect();
  }
});
```

---

## **When to Use Custom Directives?**
| Use Case | Example |
|----------|---------|
| **DOM manipulation** | Auto-focus, animations |
| **Reusable behaviors** | Tooltips, copy-to-clipboard |
| **Integration** | Laravel permissions, route helpers |
| **Performance** | Debouncing, lazy loading |

---

## **Key Considerations for Laravel**
1. **Security**: Never trust directive values blindly (sanitize inputs)
2. **Server Rendering**: Directives only run client-side
3. **Testing**: Test directives with Laravel Dusk
4. **Performance**: Avoid heavy DOM operations in directives

For complex logic, consider **composables** instead. Directives shine for low-level DOM work.

**Pro Tip:** Combine directives with Laravel's `@js` directive for safe data passing:
```blade
<button v-permission="@js($permission)">Edit</button>
``` 