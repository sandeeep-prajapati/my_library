### **Implementing SSR with Inertia.js in Laravel**

Server-Side Rendering (SSR) with Inertia.js provides faster initial page loads and better SEO. Here's how to set it up in a Laravel application:

---

## **1. Install Required Packages**
```bash
# Laravel side
composer require inertiajs/inertia-laravel

# Vue side
npm install @inertiajs/server @inertiajs/vue3 vue@next
npm install --save-dev vite-plugin-ssr @vitejs/plugin-vue
```

---

## **2. Configure Laravel for Inertia SSR**

### **2.1. Update `app/Http/Middleware/HandleInertiaRequests.php`**
```php
public function version(Request $request): ?string
{
    return parent::version($request);
}

public function share(Request $request): array
{
    return array_merge(parent::share($request), [
        'auth' => fn () => $request->user()
            ? $request->user()->only('id', 'name', 'email')
            : null,
    ]);
}
```

### **2.2. Create SSR Entry Point**
Create `resources/js/ssr.js`:
```javascript
import { createSSRApp, h } from 'vue'
import { renderToString } from '@vue/server-renderer'
import { createInertiaApp } from '@inertiajs/inertia-vue3'
import createServer from '@inertiajs/server'

createServer((page) => createInertiaApp({
  page,
  render: renderToString,
  resolve: name => require(`./Pages/${name}.vue`),
  setup({ app, props, plugin }) {
    return createSSRApp({
      render: () => h(app, props)
    }).use(plugin)
  },
}))
```

---

## **3. Configure Vite for SSR**
Update `vite.config.js`:
```javascript
import { defineConfig } from 'vite'
import laravel from 'laravel-vite-plugin'
import vue from '@vitejs/plugin-vue'
import ssr from 'vite-plugin-ssr/plugin'

export default defineConfig({
  plugins: [
    laravel({
      input: 'resources/js/app.js',
      ssr: 'resources/js/ssr.js', // SSR entry point
    }),
    vue(),
    ssr(),
  ],
  ssr: {
    noExternal: ['@inertiajs/server']
  }
})
```

---

## **4. Update NPM Scripts**
In `package.json`:
```json
"scripts": {
  "dev": "vite",
  "build": "vite build",
  "build:ssr": "vite build --ssr",
  "start": "node bootstrap/ssr/ssr.mjs"
}
```

---

## **5. Create SSR Bootstrap File**
Create `bootstrap/ssr/ssr.mjs`:
```javascript
import { createServer } from 'http'
import { InertiaSSR } from '@inertiajs/server'

const port = process.env.SSR_PORT || 13714

createServer(InertiaSSR('http://localhost:8000')).listen(port, () => {
  console.log(`SSR server running on port ${port}`)
})
```

---

## **6. Update Laravel Routes**
In `routes/web.php`:
```php
Route::get('/', function () {
    return Inertia::render('Home', [
        'events' => Event::latest()->get()
    ]);
})->middleware(['srr']); // New SSR middleware
```

Create SSR middleware:
```bash
php artisan make:middleware EnsureSSR
```

```php
public function handle($request, Closure $next)
{
    if ($request->header('X-Inertia-SSR') === 'true') {
        config()->set('inertia.ssr.enabled', true);
    }

    return $next($request);
}
```

---

## **7. Start the Servers**
```bash
# Terminal 1: Laravel
php artisan serve

# Terminal 2: Vite dev
npm run dev

# Terminal 3: SSR server
npm run build:ssr && npm run start
```

---

## **Key Configuration Points**
| Setting | Purpose |
|---------|---------|
| `ssr.js` | SSR entry point with Vue setup |
| `vite.config.js` | SSR build configuration |
| `ssr.mjs` | Node server for SSR rendering |
| `HandleInertiaRequests` | Shared data between client/server |

---

## **When to Use SSR?**
- **SEO-critical pages** (marketing, product listings)
- **Content-heavy pages** where Time-to-Interactive matters
- **Progressive Enhancement** strategies

For admin panels/dashboards, **CSR (Client-Side Rendering)** is often sufficient.

---

## **Performance Comparison**
| Metric | CSR | SSR |
|--------|-----|-----|
| **TTFB** | ~300ms | ~150ms |
| **LCP** | ~2s | ~800ms |
| **SEO** | Requires hydration | Native support |

---

## **Troubleshooting Tips**
1. **"Hydration mismatch"** → Ensure server/client data is identical
2. **"Window is not defined"** → Wrap browser-only code in `if (process.client)`
3. **Slow SSR?** → Cache responses with Laravel Redis

For advanced use, consider **Nuxt.js with Laravel API backend** as an alternative.