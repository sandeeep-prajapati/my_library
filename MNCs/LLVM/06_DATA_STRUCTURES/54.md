### ✅ What is **Dominance** in a Control Flow Graph (CFG)?

In a **Control Flow Graph (CFG)**, **dominance** is a fundamental concept used in many compiler analyses and optimizations—especially SSA construction.

---

### 💡 Definition: Dominance

A node **A dominates** a node **B** (written as **A dom B**) if:

> 🔹 Every path from the **entry node** to **B** must go through **A**.

* A node **always dominates itself**.
* If A ≠ B and A dominates B, then A **strictly dominates** B.
* The **immediate dominator** (idom) of B is the **last dominator of B before B**.

---

### 🔁 Example CFG

```plaintext
      Entry
        |
        v
        A
      /   \
     B     C
      \   /
        D
        |
       Exit
```

* Entry dominates everything
* A dominates B, C, D, Exit
* D is dominated by A, but not by B or C
* Immediate dominator of D is A

---

### 🧠 Dominance Tree

You can represent dominance as a tree:

```plaintext
Entry
 └── A
     ├── B
     ├── C
     └── D
         └── Exit
```

---

### ⚙️ How is Dominance Computed?

LLVM (and most compilers) use the **Lengauer-Tarjan algorithm** to efficiently compute dominance in nearly linear time.

#### ✅ Naive Algorithm (for understanding):

Let `Dom(B)` be the set of nodes that dominate `B`.

```text
1. Dom(Entry) = {Entry}
2. For all other blocks B:
   Dom(B) = AllNodes

3. Repeat until convergence:
   For each B ≠ Entry:
       Dom(B) = {B} ∪ ⋂ (Dom(P) for all predecessors P of B)
```

Repeat step 3 until no changes occur.

---

### 🧪 Example Walkthrough

#### CFG:

```plaintext
Entry
  |
  v
  A
 / \
B   C
 \ /
  D
```

#### Initial:

* Dom(Entry) = {Entry}
* Dom(A) = Dom(B) = Dom(C) = Dom(D) = {Entry, A, B, C, D}

#### After iteration:

* Dom(A) = {Entry, A}
* Dom(B) = {Entry, A, B}
* Dom(C) = {Entry, A, C}
* Dom(D) = {Entry, A, D} ← from intersection of B and C dominators

---

### 🔧 In LLVM

LLVM provides:

* `DominatorTree` class in `llvm/IR/Dominators.h`
* `llvm::DominatorTreeAnalysis` pass to compute it
* Usage in optimizations and SSA (`phi` node insertion)

You can use:

```bash
opt -analyze -domtree my.ll
```

---

### 🧩 Related Concepts

| Term                           | Meaning                                                          |
| ------------------------------ | ---------------------------------------------------------------- |
| **Post-dominance**             | Node A post-dominates B if all paths from B to exit go through A |
| **Dominator Tree**             | Tree structure of dominance relationships                        |
| **Immediate Dominator (idom)** | The closest strict dominator of a node                           |
| **Dominance Frontier**         | Where dominance "stops" — useful for placing `phi` nodes         |

---

### ✅ Summary

| Concept     | Explanation                                                |
| ----------- | ---------------------------------------------------------- |
| Dominance   | A dominates B if every path from Entry to B goes through A |
| Used for    | Building SSA form, inserting `phi` nodes, optimizations    |
| Computation | Iterative algorithm or efficient LT algorithm              |
| LLVM Tool   | `opt -analyze -domtree`                                    |

---
