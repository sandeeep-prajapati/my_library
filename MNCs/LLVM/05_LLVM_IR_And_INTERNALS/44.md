
---

## âœ… What is `opt`?

**`opt`** is an LLVM **tool to apply passes to LLVM IR**.

* Works on **LLVM IR files** (`.ll` or `.bc`).
* Can **run analysis passes**, **transformations**, and **custom passes**.
* Useful for **debugging, testing, and optimizing LLVM IR** before generating machine code.

---

## ðŸ”¹ Basic Usage

```bash
opt [options] < input.bc > output.bc
```

* `< input.bc` â†’ LLVM IR input (bitcode or text).
* `> output.bc` â†’ Output LLVM IR after passes.
* `[options]` â†’ Specify which passes to run.

---

### ðŸ”¹ Common Options

| Option                     | Description                                    |
| -------------------------- | ---------------------------------------------- |
| `-O0`, `-O1`, `-O2`, `-O3` | Predefined optimization pipelines              |
| `-analyze`                 | Run **analysis passes only**, do not modify IR |
| `-print-after-all`         | Print IR **after every pass**                  |
| `-load ./MyPass.so`        | Load a **custom pass shared library**          |
| `-my-pass`                 | Run your **custom pass** (must be registered)  |

---

## ðŸ”¹ Example: Run a Built-in Pass

Suppose you want to **run `mem2reg`** (promote memory to registers):

```bash
opt -mem2reg < input.bc > output.bc
```

* Promotes stack variables (`alloca`) to SSA registers.
* `output.bc` contains the **optimized IR**.

---

## ðŸ”¹ Example: Test a Custom Pass

Assume you have **`CountInstPass.so`**:

```bash
opt -load ./CountInstPass.so -countinst < input.bc > /dev/null
```

* `-load ./CountInstPass.so` â†’ Load your pass library
* `-countinst` â†’ Run your custom pass
* Output (on `stderr`) shows instruction counts for each function

---

## ðŸ”¹ Example: Analyze Without Modifying IR

```bash
opt -analyze -loop-info < input.bc
```

* `-analyze` â†’ Do **not change IR**
* `-loop-info` â†’ Print **loop analysis**
* Useful for understanding **control flow, loops, and SSA**

---

## ðŸ”¹ Tips for Testing Passes

1. **Use small C/C++ programs** for quick iterations.
2. **Generate readable IR**:

```bash
clang -O0 -emit-llvm -S test.c -o test.ll
```

3. **Run passes with `-S`** to keep **human-readable `.ll` IR**:

```bash
opt -load ./MyPass.so -my-pass -S < test.ll > out.ll
```

4. **Check the effects** by inspecting the output IR (`out.ll`).

---

### ðŸ”¹ Summary

* `opt` is the **LLVM tool for testing and running passes**.
* Supports **built-in and custom passes**.
* Can run **analysis-only**, **transformations**, or **full optimization pipelines**.
* Works with **bitcode (`.bc`)** or **LLVM assembly (`.ll`)**.

---
