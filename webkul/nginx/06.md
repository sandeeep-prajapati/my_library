# 1ï¸âƒ£ How Nginx Serves Static Files (Internals)

When a request comes in for a static file (CSS, JS, image, PDF):

```
Client â†’ Nginx â†’ Disk â†’ Client
```

Nginx:

* Uses **event-driven, non-blocking I/O**
* No threads, no processes per request
* Uses **sendfile()** (zero-copy)

### Zero-Copy (sendfile)

```nginx
sendfile on;
```

â¡ File goes **directly from disk â†’ network socket**
â¡ No copying into user memory
â¡ Near-zero CPU usage

---

# 2ï¸âƒ£ Why Nginx Is Crazy Fast for Static Content

### Key Reasons

| Feature        | Why itâ€™s fast                |
| -------------- | ---------------------------- |
| Event-driven   | One worker handles thousands |
| sendfile       | Zero memory copy             |
| epoll          | Efficient I/O notifications  |
| No app runtime | No PHP / Python / JS         |
| Kernel caching | OS caches hot files          |

Result:

> **Nginx can serve 100k+ static requests/sec** on modest hardware

---

# 3ï¸âƒ£ Basic Static File Configuration

```nginx
server {
    listen 80;
    root /var/www/html;

    location / {
        try_files $uri $uri/ =404;
    }
}
```

### What happens internally

* `$uri` â†’ maps directly to filesystem
* No backend involvement
* Fast path execution

---

# 4ï¸âƒ£ Static File Caching (Browser-Level)

```nginx
location ~* \.(css|js|jpg|jpeg|png|gif|ico|svg|woff2)$ {
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

âœ” Browser stops re-requesting
âœ” Massive bandwidth savings
âœ” Faster perceived load time

---

# 5ï¸âƒ£ Why Backends Are BAD at Static Files

### Backend servers:

* Django / Laravel / Node
* Thread or worker per request
* Memory heavy
* Blocking I/O

Serving a 2MB image via backend = ğŸ’¥ waste

---

# 6ï¸âƒ£ Combining Nginx + Backend (Best Practice)

### Architecture

```
Client
   â†“
 Nginx
   â”œâ”€â”€ Static files (fast path)
   â””â”€â”€ Dynamic requests â†’ Backend
```

Nginx decides:

* â€œCan I serve this?â€ â†’ **Yes â†’ serve directly**
* â€œNeeds logic?â€ â†’ **Forward to backend**

---

# 7ï¸âƒ£ Nginx + Node.js (Dynamic API)

```nginx
server {
    listen 80;

    root /var/www/frontend;

    location / {
        try_files $uri @node;
    }

    location @node {
        proxy_pass http://127.0.0.1:3000;
    }
}
```

### Flow

```
/logo.png   â†’ served by Nginx
/api/users  â†’ Node.js
```

---

# 8ï¸âƒ£ Nginx + Django (Gunicorn)

```nginx
server {
    listen 80;

    location /static/ {
        alias /var/www/django/static/;
    }

    location /media/ {
        alias /var/www/django/media/;
    }

    location / {
        proxy_pass http://127.0.0.1:8000;
    }
}
```

âœ” Django handles logic
âœ” Nginx handles static + media

---

# 9ï¸âƒ£ Nginx + Laravel (PHP-FPM)

```nginx
server {
    listen 80;
    root /var/www/laravel/public;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include fastcgi_params;
        fastcgi_pass unix:/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}
```

âœ” CSS / JS â†’ Nginx
âœ” PHP â†’ PHP-FPM
âœ” No Laravel boot for assets

---

# ğŸ”Ÿ try_files (Secret Weapon)

```nginx
try_files $uri $uri/ /index.php;
```

Meaning:

1. Check if file exists
2. Check if directory exists
3. Fallback to backend

ğŸ”¥ This is why Nginx feels â€œsmartâ€

---

# 11ï¸âƒ£ Performance Impact (Real Numbers)

| Scenario              | Result                |
| --------------------- | --------------------- |
| Backend serves static | Slow, memory heavy    |
| Nginx serves static   | 10â€“50x faster         |
| Browser caching       | Near-zero repeat load |
| sendfile enabled      | Minimal CPU usage     |

---

# 12ï¸âƒ£ Common Mistakes (âš ï¸ Avoid These)

âŒ Let backend serve static
âŒ Forget `alias` vs `root` difference
âŒ Cache dynamic API responses blindly
âŒ Wrong permissions on static dir
âŒ Disable sendfile on local disk

---

# ğŸ¯ Interview-Ready Explanation (30 sec)

> â€œNginx efficiently serves static files using an event-driven model, epoll, and zero-copy sendfile, allowing one worker to handle thousands of requests with minimal CPU usage. For dynamic content, Nginx acts as a reverse proxy, forwarding requests to backend servers while offloading static assets and caching.â€

---
