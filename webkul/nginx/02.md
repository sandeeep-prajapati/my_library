## 1Ô∏è‚É£ Reverse Proxy Basics (Concept)

```
Client ‚îÄ‚îÄ‚ñ∫ Nginx ‚îÄ‚îÄ‚ñ∫ Backend App
         (80/443)   (3000 / 8000 / 9000)
```

Nginx:

* Handles **HTTP, HTTPS, SSL**
* Manages **connections & concurrency**
* Forwards requests to backend apps

---

## 2Ô∏è‚É£ Common Reverse Proxy Headers (MUST HAVE)

Always include these:

```nginx
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
```

Why?

* Correct client IP
* HTTPS awareness
* Proper redirects
* Logging accuracy

---

## 3Ô∏è‚É£ Node.js (Express / Nest / Fastify)

### Node App

```js
app.listen(3000);
```

### Nginx Config

```nginx
server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;

        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_read_timeout 60s;
        proxy_connect_timeout 10s;
        proxy_send_timeout 60s;
    }
}
```

### üî• Important for Node

* `Upgrade` headers ‚Üí **WebSockets**
* HTTP/1.1 ‚Üí keep-alive

---

## 4Ô∏è‚É£ Django (Gunicorn / Uvicorn)

### Gunicorn

```bash
gunicorn myproject.wsgi:application --bind 127.0.0.1:8000
```

### Nginx Config

```nginx
server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://127.0.0.1:8000;

        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_read_timeout 120s;
    }

    location /static/ {
        alias /var/www/myproject/static/;
    }

    location /media/ {
        alias /var/www/myproject/media/;
    }
}
```

### Django Settings (CRITICAL)

```python
ALLOWED_HOSTS = ['example.com']
USE_X_FORWARDED_HOST = True
SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
```

---

## 5Ô∏è‚É£ Laravel (PHP-FPM ‚Äî NOT proxy_pass!)

Laravel is different: **FastCGI**, not HTTP proxy.

### Nginx Config

```nginx
server {
    listen 80;
    server_name example.com;
    root /var/www/laravel/public;

    index index.php;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include fastcgi_params;
        fastcgi_pass unix:/run/php/php8.2-fpm.sock;

        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param HTTPS $https;

        fastcgi_read_timeout 60s;
    }
}
```

### Laravel Trusted Proxies

```php
// App\Http\Middleware\TrustProxies.php
protected $proxies = '*';
```

---

## 6Ô∏è‚É£ Timeout Settings (Production Safe Defaults)

```nginx
proxy_connect_timeout 10s;
proxy_send_timeout 60s;
proxy_read_timeout 60s;
send_timeout 60s;
```

### When to increase?

* Long API calls
* File uploads
* ML / data processing

---

## 7Ô∏è‚É£ Common Pitfalls (‚ö†Ô∏è Read This)

### ‚ùå Missing Trailing Slash

```nginx
proxy_pass http://127.0.0.1:3000;
# NOT
proxy_pass http://127.0.0.1:3000/;
```

‚û° Causes broken routes

---

### ‚ùå 502 Bad Gateway

Reasons:

* Backend not running
* Wrong port / socket
* Permission issue (PHP-FPM)

Debug:

```bash
tail -f /var/log/nginx/error.log
```

---

### ‚ùå Client IP Always 127.0.0.1

Cause:

* Missing headers

Fix:

```nginx
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
```

---

### ‚ùå Large File Upload Fails

Fix:

```nginx
client_max_body_size 100M;
```

---

### ‚ùå HTTPS Redirect Loop

Cause:

* Missing `X-Forwarded-Proto`

Fix:

```nginx
proxy_set_header X-Forwarded-Proto $scheme;
```

---

## 8Ô∏è‚É£ Production Best Practices

‚úî Use Nginx only for:

* SSL
* Static files
* Routing

‚úî Backend handles:

* Business logic
* Database
* Auth

‚úî Always test:

```bash
nginx -t
systemctl reload nginx
```

---

## 9Ô∏è‚É£ Quick Decision Table

| App     | Nginx Method   |
| ------- | -------------- |
| Node.js | `proxy_pass`   |
| Django  | `proxy_pass`   |
| Laravel | `fastcgi_pass` |
| Static  | Nginx direct   |

---
